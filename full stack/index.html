<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internship & Volunteer Platform</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple transition for view switching */
        .view {
            display: none;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header and Navigation -->
        <header class="bg-white rounded-xl shadow-md p-4 mb-8">
            <nav class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-indigo-600">OrgConnect</h1>
                </div>
                <ul class="flex space-x-4 sm:space-x-6">
                    <li><a href="#home" class="nav-link text-gray-600 hover:text-indigo-600 font-medium pb-1 border-b-2 border-transparent">Home</a></li>
                    <li><a href="#register" class="nav-link text-gray-600 hover:text-indigo-600 font-medium pb-1 border-b-2 border-transparent">Register</a></li>
                    <li><a href="#admin" class="nav-link text-gray-600 hover:text-indigo-600 font-medium pb-1 border-b-2 border-transparent">Admin</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <!-- Home Page View -->
            <div id="home-view" class="view">
                <div class="bg-white p-8 rounded-xl shadow-md text-center">
                    <h2 class="text-3xl font-bold mb-4">Join Our Mission</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto mb-6">
                        We are looking for passionate interns and volunteers to help us make a difference.
                        Whether you're a student looking for experience or an individual wanting to contribute to a good cause, we have a place for you.
                    </p>
                    <button onclick="showView('register-view')" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition duration-300">
                        Apply Now
                    </button>
                </div>
            </div>

            <!-- Registration Form View -->
            <div id="register-view" class="view">
                <div class="bg-white p-8 rounded-xl shadow-md max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold mb-6 text-center">Registration Form</h2>
                    <form id="registration-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Full Name -->
                            <div class="md:col-span-2">
                                <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input type="text" id="fullName" name="fullName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- Email Address -->
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                <input type="email" id="email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- Phone Number -->
                            <div>
                                <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                <input type="tel" id="phone" name="phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- Position -->
                            <div class="md:col-span-2">
                                <label for="position" class="block text-sm font-medium text-gray-700 mb-1">Applying For</label>
                                <select id="position" name="position" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Select a position</option>
                                    <option value="Intern">Intern</option>
                                    <option value="Volunteer">Volunteer</option>
                                </select>
                            </div>

                            <!-- Why are you interested? -->
                            <div class="md:col-span-2">
                                <label for="interest" class="block text-sm font-medium text-gray-700 mb-1">Why are you interested in this role?</label>
                                <textarea id="interest" name="interest" rows="4" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="mt-8 text-center">
                            <button type="submit" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition duration-300 w-full sm:w-auto">
                                Submit Application
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Admin View -->
            <div id="admin-view" class="view">
                 <div class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-3xl font-bold mb-6">Applicant Submissions</h2>
                    <div id="no-applicants-message" class="text-center py-12 bg-gray-50 rounded-lg">
                        <p class="text-gray-500">No applications have been submitted yet.</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table id="applicants-table" class="min-w-full bg-white hidden">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="text-left py-3 px-4 font-semibold text-sm">Name</th>
                                    <th class="text-left py-3 px-4 font-semibold text-sm">Email</th>
                                    <th class="text-left py-3 px-4 font-semibold text-sm">Position</th>
                                    <th class="text-left py-3 px-4 font-semibold text-sm">Submitted On</th>
                                </tr>
                            </thead>
                            <tbody id="applicants-list" class="text-gray-700">
                                <!-- Applicant rows will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Success Message Modal -->
        <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white p-8 rounded-xl shadow-2xl text-center transform transition-all scale-95">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                    <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900">Application Submitted!</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">Thank you for your interest. We will review your application and get back to you soon.</p>
                </div>
                <div class="mt-4">
                    <button onclick="closeModal()" class="px-4 py-2 bg-indigo-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        Close
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- DOM ELEMENTS ---
        const views = document.querySelectorAll('.view');
        const navLinks = document.querySelectorAll('.nav-link');
        const registrationForm = document.getElementById('registration-form');
        const applicantsList = document.getElementById('applicants-list');
        const applicantsTable = document.getElementById('applicants-table');
        const noApplicantsMessage = document.getElementById('no-applicants-message');
        const successModal = document.getElementById('success-modal');

        // --- FUNCTIONS ---

        /**
         * Shows a specific view by its ID and hides others.
         * @param {string} viewId - The ID of the view to display (e.g., 'home-view').
         */
        function showView(viewId) {
            views.forEach(view => { view.style.display = 'none'; });
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.style.display = 'block';
            }
            updateNavLinks(viewId);

            // If the admin view is being shown, fetch the latest data
            if (viewId === 'admin-view') {
                renderAdminView();
            }
        }
        
        /**
         * Updates the navigation links to highlight the active view.
         * @param {string} activeViewId - The ID of the currently active view.
         */
        function updateNavLinks(activeViewId) {
            const hash = activeViewId.replace('-view', '');
            navLinks.forEach(link => {
                if (link.getAttribute('href') === `#${hash}`) {
                    link.classList.add('text-indigo-600', 'border-indigo-600');
                    link.classList.remove('text-gray-600', 'border-transparent');
                } else {
                    link.classList.remove('text-indigo-600', 'border-indigo-600');
                    link.classList.add('text-gray-600', 'border-transparent');
                }
            });
        }

        /**
         * Fetches applicant data from the backend and renders it in the admin table.
         */
        async function renderAdminView() {
            try {
                const response = await fetch('/api/applicants');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const applicants = await response.json();

                applicantsList.innerHTML = ''; // Clear the current list

                if (applicants.length === 0) {
                    applicantsTable.classList.add('hidden');
                    noApplicantsMessage.style.display = 'block';
                } else {
                    applicantsTable.classList.remove('hidden');
                    noApplicantsMessage.style.display = 'none';

                    applicants.forEach(applicant => {
                        const row = document.createElement('tr');
                        row.className = 'border-b hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="py-3 px-4">${applicant.fullName}</td>
                            <td class="py-3 px-4"><a href="mailto:${applicant.email}" class="text-indigo-600 hover:underline">${applicant.email}</a></td>
                            <td class="py-3 px-4">${applicant.position}</td>
                            <td class="py-3 px-4 text-sm text-gray-500">${applicant.submittedOn}</td>
                        `;
                        applicantsList.appendChild(row);
                    });
                }
            } catch (error) {
                console.error("Failed to fetch applicants:", error);
                applicantsList.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-red-500">Failed to load data. Is the backend server running?</td></tr>';
                applicantsTable.classList.remove('hidden');
                noApplicantsMessage.style.display = 'none';
            }
        }

        /**
         * Handles the submission of the registration form by sending data to the backend.
         * @param {Event} event - The form submission event.
         */
        async function handleFormSubmit(event) {
            event.preventDefault();

            const formData = new FormData(registrationForm);
            const newApplicant = {
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                position: formData.get('position'),
                interest: formData.get('interest'),
            };

            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newApplicant)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log(result.message); // Log success message from server

                registrationForm.reset();
                successModal.classList.remove('hidden');
                successModal.querySelector('div').classList.add('scale-100');
                
            } catch (error) {
                console.error("Failed to submit application:", error);
                alert('There was an error submitting your application. Please try again.');
            }
        }
        
        /**
         * Closes the success modal.
         */
        function closeModal() {
            successModal.querySelector('div').classList.remove('scale-100');
            successModal.classList.add('hidden');
        }

        // --- EVENT LISTENERS ---

        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const viewId = event.target.getAttribute('href').substring(1) + '-view';
                window.location.hash = event.target.getAttribute('href');
                showView(viewId);
            });
        });

        registrationForm.addEventListener('submit', handleFormSubmit);

        // --- INITIALIZATION ---
        
        function initialize() {
            const initialHash = window.location.hash || '#home';
            const initialView = initialHash.substring(1) + '-view';
            showView(initialView);
        }
        
        window.addEventListener('load', initialize);
        window.addEventListener('hashchange', initialize);

    </script>
</body>
</html>
